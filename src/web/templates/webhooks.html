{{#*inline "title"}}Webhooks{{/inline}}
{{#*inline "current_page"}}webhooks{{/inline}}

{{#*inline "content"}}
<div class="page-header">
    <h1 class="page-title">Webhook Configuration</h1>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Dashboard</a></li>
            <li class="breadcrumb-item active" aria-current="page">Webhooks</li>
        </ol>
    </nav>
</div>

<!-- Stats Cards -->
<div class="row g-3 mb-4">
    <div class="col-12 col-sm-6 col-lg-3">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1">Active Webhooks</h6>
                        <h3 class="mb-0">{{#if active_webhooks}}{{active_webhooks}}{{else}}0{{/if}}</h3>
                    </div>
                    <div class="text-primary">
                        <i class="bi bi-arrow-left-right fs-1"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1">Deliveries Today</h6>
                        <h3 class="mb-0">{{#if deliveries_today}}{{deliveries_today}}{{else}}0{{/if}}</h3>
                    </div>
                    <div class="text-success">
                        <i class="bi bi-send fs-1"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1">Success Rate</h6>
                        <h3 class="mb-0">{{#if success_rate}}{{success_rate}}%{{else}}100%{{/if}}</h3>
                    </div>
                    <div class="text-info">
                        <i class="bi bi-check-circle fs-1"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1">Failed Deliveries</h6>
                        <h3 class="mb-0">{{#if failed_deliveries}}{{failed_deliveries}}{{else}}0{{/if}}</h3>
                    </div>
                    <div class="text-danger">
                        <i class="bi bi-exclamation-triangle fs-1"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Webhook Management -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="bi bi-arrow-left-right me-2"></i>
            Configured Webhooks
        </h5>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newWebhookModal">
            <i class="bi bi-plus-circle me-1"></i>
            Add Webhook
        </button>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>URL</th>
                        <th>Events</th>
                        <th>Status</th>
                        <th>Last Delivery</th>
                        <th>Success Rate</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {{#if webhooks}}
                        {{#each webhooks}}
                        <tr>
                            <td>
                                <div class="fw-semibold">{{name}}</div>
                                <small class="text-muted">{{description}}</small>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <code class="text-truncate" style="max-width: 200px;">{{url}}</code>
                                    <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('{{url}}')" title="Copy URL">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </td>
                            <td>
                                <div class="d-flex gap-1 flex-wrap">
                                    {{#each events}}
                                    <span class="badge bg-secondary">{{this}}</span>
                                    {{/each}}
                                </div>
                            </td>
                            <td>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" {{#if enabled}}checked{{/if}} onchange="toggleWebhook('{{id}}', this.checked)">
                                    <label class="form-check-label">{{#if enabled}}Active{{else}}Disabled{{/if}}</label>
                                </div>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success me-2">
                                        âœ“
                                    </span>
                                    <small class="text-muted">{{last_delivery}}</small>
                                </div>
                            </td>
                            <td>
                                <div class="progress" style="height: 20px; min-width: 80px;">
                                    <div class="progress-bar {{#gte success_rate 90}}bg-success{{else}}{{#gte success_rate 70}}bg-warning{{else}}bg-danger{{/gte}}{{/gte}}" 
                                         style="width: {{success_rate}}%">{{success_rate}}%</div>
                                </div>
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-sm btn-outline-info" onclick="testWebhook('{{id}}')" title="Test Webhook">
                                        <i class="bi bi-play"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewDeliveries('{{id}}')" title="View Deliveries">
                                        <i class="bi bi-list"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" onclick="editWebhook('{{id}}')" title="Edit">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteWebhook('{{id}}')" title="Delete">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {{/each}}
                    {{else}}
                        <tr>
                            <td colspan="7" class="text-center text-muted py-4">
                                <i class="bi bi-arrow-left-right fs-1 d-block mb-2"></i>
                                No webhooks configured yet
                            </td>
                        </tr>
                    {{/if}}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Recent Deliveries -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="bi bi-clock-history me-2"></i>
            Recent Deliveries
        </h5>
        <div class="btn-group">
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="refreshDeliveries()">
                <i class="bi bi-arrow-clockwise"></i>
            </button>
            <button type="button" class="btn btn-outline-primary btn-sm" onclick="exportDeliveries()">
                <i class="bi bi-download"></i> Export
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Webhook</th>
                        <th>Event</th>
                        <th>Status</th>
                        <th>Response Code</th>
                        <th>Response Time</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="deliveriesTable">
                    {{#if deliveries}}
                        {{#each deliveries}}
                        <tr>
                            <td>
                                <small>{{timestamp}}</small>
                            </td>
                            <td>
                                <small class="fw-semibold">{{webhook_name}}</small>
                            </td>
                            <td>
                                <span class="badge bg-info">{{event_type}}</span>
                            </td>
                            <td>
                                <span class="badge bg-success">
                                    {{status}}
                                </span>
                            </td>
                            <td>
                                <code>{{response_code}}</code>
                            </td>
                            <td>
                                <small>{{response_time}}ms</small>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-secondary" onclick="viewDeliveryDetails('{{id}}')" title="View Details">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </td>
                        </tr>
                        {{/each}}
                    {{else}}
                        <tr>
                            <td colspan="7" class="text-center text-muted py-3">
                                No deliveries recorded yet
                            </td>
                        </tr>
                    {{/if}}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- New Webhook Modal -->
<div class="modal fade" id="newWebhookModal" tabindex="-1" aria-labelledby="newWebhookModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title" id="newWebhookModalLabel">
                    <i class="bi bi-plus-circle me-2"></i>
                    Add New Webhook
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="webhookForm">
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-12">
                            <label for="webhookName" class="form-label">Webhook Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="webhookName" name="name" required>
                        </div>
                        
                        <div class="col-12">
                            <label for="webhookDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="webhookDescription" name="description" rows="2" placeholder="Optional description for this webhook"></textarea>
                        </div>
                        
                        <div class="col-12">
                            <label for="webhookUrl" class="form-label">Webhook URL <span class="text-danger">*</span></label>
                            <input type="url" class="form-control" id="webhookUrl" name="url" required placeholder="https://your-service.com/webhook">
                            <small class="text-muted">Must be a valid HTTPS URL</small>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="webhookMethod" class="form-label">HTTP Method</label>
                            <select class="form-select" id="webhookMethod" name="method">
                                <option value="POST" selected>POST</option>
                                <option value="PUT">PUT</option>
                                <option value="PATCH">PATCH</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="webhookTimeout" class="form-label">Timeout (seconds)</label>
                            <input type="number" class="form-control" id="webhookTimeout" name="timeout" value="30" min="5" max="300">
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">Trigger Events <span class="text-danger">*</span></label>
                            <div class="row g-2">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="eventZoneCreate" name="events" value="zone.created">
                                        <label class="form-check-label" for="eventZoneCreate">
                                            Zone Created
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="eventZoneUpdate" name="events" value="zone.updated">
                                        <label class="form-check-label" for="eventZoneUpdate">
                                            Zone Updated
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="eventZoneDelete" name="events" value="zone.deleted">
                                        <label class="form-check-label" for="eventZoneDelete">
                                            Zone Deleted
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="eventRecordChange" name="events" value="record.changed">
                                        <label class="form-check-label" for="eventRecordChange">
                                            Record Changed
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="eventAlert" name="events" value="alert.triggered">
                                        <label class="form-check-label" for="eventAlert">
                                            Alert Triggered
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="eventHealth" name="events" value="health.check">
                                        <label class="form-check-label" for="eventHealth">
                                            Health Check Failed
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="eventCertificate" name="events" value="certificate.renewal">
                                        <label class="form-check-label" for="eventCertificate">
                                            Certificate Renewal
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="eventSecurity" name="events" value="security.incident">
                                        <label class="form-check-label" for="eventSecurity">
                                            Security Incident
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <label for="webhookHeaders" class="form-label">Custom Headers (JSON)</label>
                            <textarea class="form-control" id="webhookHeaders" name="headers" rows="3" placeholder='{"Authorization": "Bearer token", "X-Custom-Header": "value"}'></textarea>
                            <small class="text-muted">Optional custom headers to include with requests</small>
                        </div>
                        
                        <div class="col-12">
                            <label for="webhookSecret" class="form-label">Secret Key</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="webhookSecret" name="secret" placeholder="Optional secret for HMAC signature">
                                <button class="btn btn-outline-secondary" type="button" onclick="generateSecret()">
                                    <i class="bi bi-arrow-clockwise"></i> Generate
                                </button>
                            </div>
                            <small class="text-muted">Used to sign webhook payloads for verification</small>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="webhookRetry" name="retry" checked>
                                <label class="form-check-label" for="webhookRetry">
                                    Enable automatic retries
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="webhookActive" name="active" checked>
                                <label class="form-check-label" for="webhookActive">
                                    Active immediately
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>
                        Cancel
                    </button>
                    <button type="button" class="btn btn-outline-info me-2" onclick="testWebhookUrl()">
                        <i class="bi bi-play me-1"></i>
                        Test URL
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle me-1"></i>
                        Create Webhook
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Webhook management functions
function toggleWebhook(webhookId, enabled) {
    showToast(`Webhook ${enabled ? 'enabled' : 'disabled'}`, 'info');
    // Update label
    const label = event.target.nextElementSibling;
    label.textContent = enabled ? 'Active' : 'Disabled';
}

function testWebhook(webhookId) {
    const btn = event.target.closest('button');
    const originalContent = btn.innerHTML;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
    btn.disabled = true;
    
    // Simulate webhook test
    setTimeout(() => {
        btn.innerHTML = originalContent;
        btn.disabled = false;
        
        // Add a test delivery to the table
        addTestDelivery(webhookId);
        showToast('Test webhook sent successfully', 'success');
    }, 2000);
}

function addTestDelivery(webhookId) {
    const table = document.getElementById('deliveriesTable');
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
        <td><small>${new Date().toLocaleString()}</small></td>
        <td><small class="fw-semibold">Test Webhook</small></td>
        <td><span class="badge bg-info">test</span></td>
        <td><span class="badge bg-success">success</span></td>
        <td><code>200</code></td>
        <td><small>156ms</small></td>
        <td>
            <button class="btn btn-sm btn-outline-secondary" onclick="viewDeliveryDetails('test-${Date.now()}')" title="View Details">
                <i class="bi bi-eye"></i>
            </button>
        </td>
    `;
    
    // Remove "no deliveries" message if present
    const noDeliveries = table.querySelector('.text-center.text-muted');
    if (noDeliveries) {
        noDeliveries.closest('tr').remove();
    }
    
    table.insertBefore(newRow, table.firstChild);
}

function viewDeliveries(webhookId) {
    showToast('Delivery history would be shown here', 'info');
    // In real implementation, this would show a modal with delivery history
}

function editWebhook(webhookId) {
    showToast('Edit webhook functionality would be implemented here', 'info');
    // In real implementation, this would populate the form with webhook data
}

function deleteWebhook(webhookId) {
    if (confirm('Are you sure you want to delete this webhook? This action cannot be undone.')) {
        const row = event.target.closest('tr');
        row.style.transition = 'opacity 0.3s, transform 0.3s';
        row.style.opacity = '0';
        row.style.transform = 'translateX(-20px)';
        setTimeout(() => {
            row.remove();
            showToast('Webhook deleted successfully', 'success');
        }, 300);
    }
}

function viewDeliveryDetails(deliveryId) {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">
                        <i class="bi bi-eye me-2"></i>
                        Delivery Details
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Status</label>
                            <div><span class="badge bg-success">Success</span></div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Response Code</label>
                            <div><code>200 OK</code></div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Response Time</label>
                            <div>156ms</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Attempts</label>
                            <div>1 of 3</div>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Request Payload</label>
                            <pre class="bg-light p-3 rounded">{
  "event": "zone.created",
  "timestamp": "${new Date().toISOString()}",
  "data": {
    "domain": "example.com",
    "zone_id": "12345"
  }
}</pre>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Response Body</label>
                            <pre class="bg-light p-3 rounded">{"status": "received", "message": "Webhook processed successfully"}</pre>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    modal.addEventListener('hidden.bs.modal', () => modal.remove());
}

function refreshDeliveries() {
    const btn = event.target.closest('button');
    const originalContent = btn.innerHTML;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
    btn.disabled = true;
    
    setTimeout(() => {
        btn.innerHTML = originalContent;
        btn.disabled = false;
        showToast('Deliveries refreshed', 'success');
    }, 1000);
}

function exportDeliveries() {
    // Simulate CSV export
    const csvContent = "timestamp,webhook,event,status,response_code,response_time\n" +
        "2023-12-01 10:00:00,Slack Notifications,zone.created,success,200,156\n" +
        "2023-12-01 09:30:00,Discord Alerts,alert.triggered,success,200,89\n";
    
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'webhook-deliveries.csv';
    a.click();
    window.URL.revokeObjectURL(url);
    
    showToast('Delivery log exported', 'success');
}

// Webhook form functions
function generateSecret() {
    const secretField = document.getElementById('webhookSecret');
    const randomBytes = new Uint8Array(32);
    crypto.getRandomValues(randomBytes);
    const secret = Array.from(randomBytes, byte => byte.toString(16).padStart(2, '0')).join('');
    secretField.value = secret;
    secretField.type = 'text';
    
    // Hide the secret after 3 seconds
    setTimeout(() => {
        secretField.type = 'password';
    }, 3000);
}

function testWebhookUrl() {
    const url = document.getElementById('webhookUrl').value;
    if (!url) {
        showToast('Please enter a webhook URL first', 'warning');
        return;
    }
    
    const btn = event.target;
    const originalContent = btn.innerHTML;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Testing...';
    btn.disabled = true;
    
    // Simulate URL test
    setTimeout(() => {
        btn.innerHTML = originalContent;
        btn.disabled = false;
        
        // Random success/failure for demo
        if (Math.random() > 0.2) {
            showToast('Webhook URL is reachable and valid', 'success');
        } else {
            showToast('Failed to reach webhook URL - please check the endpoint', 'error');
        }
    }, 2000);
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showToast('URL copied to clipboard', 'success');
    }).catch(() => {
        showToast('Failed to copy to clipboard', 'error');
    });
}

// Form submission
document.getElementById('webhookForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const selectedEvents = Array.from(document.querySelectorAll('input[name="events"]:checked'));
    if (selectedEvents.length === 0) {
        showToast('Please select at least one trigger event', 'warning');
        return;
    }
    
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Creating...';
    submitBtn.disabled = true;
    
    setTimeout(() => {
        const modal = bootstrap.Modal.getInstance(document.getElementById('newWebhookModal'));
        modal.hide();
        this.reset();
        showToast('Webhook created successfully', 'success');
        
        // Reset button
        submitBtn.innerHTML = '<i class="bi bi-check-circle me-1"></i>Create Webhook';
        submitBtn.disabled = false;
    }, 2000);
});

// Validate JSON headers input
document.getElementById('webhookHeaders')?.addEventListener('blur', function() {
    const value = this.value.trim();
    if (value && value !== '') {
        try {
            JSON.parse(value);
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } catch (e) {
            this.classList.add('is-invalid');
            this.classList.remove('is-valid');
        }
    } else {
        this.classList.remove('is-invalid', 'is-valid');
    }
});

// Real-time webhook simulation (for demo)
let deliveryCount = 0;
setInterval(() => {
    if (Math.random() < 0.05) { // 5% chance every 10 seconds
        deliveryCount++;
        const events = ['zone.created', 'zone.updated', 'record.changed', 'alert.triggered'];
        const statuses = ['success', 'success', 'success', 'failed']; // 75% success rate
        const event = events[Math.floor(Math.random() * events.length)];
        const status = statuses[Math.floor(Math.random() * statuses.length)];
        
        simulateWebhookDelivery({
            id: `delivery-${deliveryCount}`,
            webhook_name: 'Auto Webhook',
            event_type: event,
            status: status,
            response_code: status === 'success' ? 200 : 500,
            response_time: Math.floor(Math.random() * 300) + 50,
            timestamp: new Date().toLocaleString()
        });
    }
}, 10000);

function simulateWebhookDelivery(delivery) {
    const table = document.getElementById('deliveriesTable');
    
    // Remove "no deliveries" message if present
    const noDeliveries = table.querySelector('.text-center.text-muted');
    if (noDeliveries) {
        noDeliveries.closest('tr').remove();
    }
    
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
        <td><small>${delivery.timestamp}</small></td>
        <td><small class="fw-semibold">${delivery.webhook_name}</small></td>
        <td><span class="badge bg-info">${delivery.event_type}</span></td>
        <td><span class="badge bg-${delivery.status === 'success' ? 'success' : 'danger'}">${delivery.status}</span></td>
        <td><code>${delivery.response_code}</code></td>
        <td><small>${delivery.response_time}ms</small></td>
        <td>
            <button class="btn btn-sm btn-outline-secondary" onclick="viewDeliveryDetails('${delivery.id}')" title="View Details">
                <i class="bi bi-eye"></i>
            </button>
        </td>
    `;
    
    table.insertBefore(newRow, table.firstChild);
    
    // Keep only last 20 deliveries
    while (table.children.length > 20) {
        table.removeChild(table.lastChild);
    }
    
    // Show notification for failed deliveries
    if (delivery.status === 'failed') {
        showToast(`Webhook delivery failed: ${delivery.event_type}`, 'error');
    }
}
</script>

{{/inline}}

{{> layout}}